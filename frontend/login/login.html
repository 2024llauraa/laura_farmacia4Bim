<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Farm√°cia Sem Volta - Login</title>
  <link rel="stylesheet" href="login.css">
</head>

<body>
  <div class="login-container">
    <div class="login-header">
      <h1>üíä Farm√°cia</h1>
      <p>Bem-vindo de volta!</p>
    </div>

    <div id="loginFrame" class="login-form">
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" placeholder="Digite seu e-mail" value="berola@gmail.com" required />
      </div>
      <button class="login-button" onclick="verificarEmail()">Avan√ßar</button>
    </div>

    <div id="senhaFrame" style="display:none;" class="login-form">
      <div class="form-group">
        <p id="nomeUsuario" style="text-align: center; color: var(--primary-color); font-weight: bold; margin-bottom: 10px;"></p>
        <label for="senha">Senha</label>
        <input type="password" id="senha" placeholder="Digite sua senha" value="123" required />
      </div>
      <button class="login-button" onclick="verificarSenha()">Entrar</button>
      <button class="login-button" style="background-color: #999; margin-top: 5px;" onclick="voltarParaEmail()">Voltar</button>
    </div>

    <div class="register-link">
      <p>N√£o tem uma conta? <a href="./register.html">Cadastre-se aqui</a></p>
    </div>
  </div>

  <script>
    let emailGlobal = '';
    const API_BASE_URL = 'http://localhost:3001'; // Define  o host e a porta do servidor


    async function verificarEmail() {
      const email = document.getElementById("email").value;
      
      if (!email) {
        alert('Por favor, digite seu email.');
        return;
      }

      emailGlobal = email;

      try {
        const response = await fetch(`${API_BASE_URL}/login/verificarEmail`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });

        const data = await response.json();

        if (data.status === 'existe') {
          document.getElementById("loginFrame").style.display = "none";
          document.getElementById("senhaFrame").style.display = "block";
          document.getElementById("nomeUsuario").innerText = `Ol√°, ${data.nome}`;
        } else {
          const cadastrar = confirm("E-mail n√£o encontrado. Deseja se cadastrar?");
          if (cadastrar) {
            window.location.href = './register.html';
          }
        }
      } catch (error) {
        console.error('Erro ao verificar email:', error);
        alert('Erro de conex√£o. Tente novamente.');
      }
    }

    function voltarParaEmail() {
      document.getElementById("senhaFrame").style.display = "none";
      document.getElementById("loginFrame").style.display = "block";
      document.getElementById("senha").value = '';
    }

    async function verificarSenha() {
      const senha = document.getElementById("senha").value;
      
      if (!senha) {
        alert('Por favor, digite sua senha.');
        return;
      }

      try {
        const res = await fetch(API_BASE_URL + '/login/verificarSenha', {
          credentials: 'include',
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: emailGlobal, senha })
        });

        const data = await res.json();

        if (data.status === 'ok') {
          window.location.href = API_BASE_URL + "/menu";
        } else {
          alert("Senha incorreta!");
          document.getElementById("senha").value = '';
        }
      } catch (error) {
        console.error('Erro ao verificar senha:', error);
        alert('Erro de conex√£o. Tente novamente.');
      }
    }
  </script>
</body>

</html>